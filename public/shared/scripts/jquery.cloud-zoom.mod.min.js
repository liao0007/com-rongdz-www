"use strict";(function(n){function t(n){for(var t=1;t<arguments.length;t++)n=n.replace("%"+(t-1),arguments[t]);return n}function i(i,r){var u=n("img",i),w,b,f=null,o=null,e=null,s=null,h=null,c,g=0,a,v,nt=0,tt=0,k=0,d=0,it=0,y,p,l=this;setTimeout(function(){if(o===null){var r=i.width();i.parent().append(t('<div style="width:%0px;position:absolute;top:75%;left:%1px;text-align:center;display:none;" class="cloud-zoom-loading" >Loading...<\/div>',r/3,r/2-r/6));n(".cloud-zoom-loading",i.parent()).css("opacity",.5)}},200);this.removeBits=function(){e&&(e.remove(),e=null);s&&(s.remove(),s=null);h&&(h.remove(),h=null);n(".cloud-zoom-loading",i.parent()).remove()};this.destroy=function(){i.data("zoom",null);o&&(o.off(),o.remove(),o=null);f&&(f.remove(),f=null);l.removeBits();i.parent().attr("id")=="wrap"&&i.unwrap()};this.fadedOut=function(){f&&(f.remove(),f=null);this.removeBits()};this.controlLoop=function(){if(e){var n=y-u.offset().left-a*.5>>0,t=p-u.offset().top-v*.5>>0;n<0?n=0:n>u.outerWidth()-a&&(n=u.outerWidth()-a);t<0?t=0:t>u.outerHeight()-v&&(t=u.outerHeight()-v);e.css({left:n,top:t});e.css("background-position",-n+"px "+-t+"px");nt=n/u.outerWidth()*c.width>>0;tt=t/u.outerHeight()*c.height>>0;d+=(nt-d)/r.smoothMove;k+=(tt-k)/r.smoothMove;f.css("background-position",-(d>>0)+"px "+(-(k>>0)+"px"))}g=setTimeout(function(){l.controlLoop()},30)};this.init2=function(n,t){it++;t===1&&(c=n);it===2&&i.data("zoom")===this&&this.init()};this.init=function(){var k,w,b;if(n(".cloud-zoom-loading",i.parent()).remove(),k=n('<div class="mousetrap cloud-zoom-trans"><\/div>'),o=i.parent().append(k).find(":last"),o=n(".mousetrap",i.parent()),o.css({width:u.outerWidth(),height:u.outerHeight(),top:0,left:0,position:"absolute",zIndex:9990}),Modernizr.touch){if(r.touch)o.on("touchmove",this,function(n){n.preventDefault();var t=n.originalEvent;t.targetTouches&&t.targetTouches.length>0&&(y=t.targetTouches[0].pageX,p=t.targetTouches[0].pageY)})}else o.on("mousemove",this,function(n){y=n.pageX;p=n.pageY});if(w=function(){return clearTimeout(g),e&&e.fadeOut(299),s&&s.fadeOut(299),h&&h.fadeOut(299),f.fadeOut(300,function(){l.fadedOut()}),!1},b=function(w){var k,b,ut;Modernizr.touch&&(w.preventDefault(),k=w.originalEvent,k.targetTouches&&k.targetTouches.length>0&&(y=k.targetTouches[0].pageX,p=k.targetTouches[0].pageY));f&&(f.stop(!0,!1),f.remove());var nt=r.adjustX,tt=r.adjustY,it=u.outerWidth(),rt=u.outerHeight(),d=r.zoomWidth,g=r.zoomHeight;r.zoomWidth=="auto"&&(d=it);r.zoomHeight=="auto"&&(g=rt);b=i.parent();switch(r.position){case"top":tt-=g;break;case"right":nt+=it;break;case"bottom":tt+=rt;break;case"left":nt-=d;break;case"inside":d=it;g=rt;break;default:b=n("#"+r.position);b.length?(d=b.innerWidth(),g=b.innerHeight()):(b=i,nt+=it,tt+=rt)}f=b.append(t('<div id="cloud-zoom-big" class="cloud-zoom-big" style="display:none;position:absolute;left:%0px;top:%1px;width:%2px;height:%3px;background-image:url(\'%4\');z-index:99;"><\/div>',nt,tt,d,g,c.src)).find(":last");f=n(".cloud-zoom-big",b);u.attr("title")&&r.showTitle&&(f.append(t('<div class="cloud-zoom-title">%0<\/div>',u.attr("title"))),n(".cloud-zoom-title",f).css("opacity",r.titleOpacity));f.fadeIn(600);e&&(e.remove(),e=null);a=u.outerWidth()/c.width*f.width();v=u.outerHeight()/c.height*f.height();e=i.append(t("<div class = 'cloud-zoom-lens' style='display:none;z-index:98;position:absolute;width:%0px;height:%1px;'><\/div>",a,v)).find(":last");e=n(".cloud-zoom-lens",i);o.css("cursor",e.css("cursor"));ut=!1;r.tint&&(e.css("background",'url("'+u.attr("src")+'")'),s=i.append(t('<div class="cloud-zoom-tint" style="display:none;position:absolute; left:0px; top:0px; width:%0px; height:%1px; background-color:%2;" />',u.outerWidth(),u.outerHeight(),r.tint)).find(":last"),s=n(".cloud-zoom-tint",i),s.css("opacity",r.tintOpacity),ut=!0,s.fadeIn(500));r.softFocus&&(e.css("background",'url("'+u.attr("src")+'")'),i.append(t('<div class="cloud-zoom-soft" style="position:absolute;display:none;top:2px; left:2px; width:%0px; height:%1px;" />',u.outerWidth()-2,u.outerHeight()-2,r.tint)),h=n(".cloud-zoom-soft",i),h.css("background",'url("'+u.attr("src")+'")'),h.css("opacity",.5),ut=!0,h.fadeIn(500));ut||e.css("opacity",r.lensOpacity);r.position!=="inside"&&e.fadeIn(500);l.controlLoop();return},Modernizr.touch){if(r.touch){o.on("touchend",r.once?this.destroy:w);o.on("touchstart",b)}}else if(r.hoverIntent)o.hoverIntent(b,r.once?this.destroy:w);else{o.on("mouseleave",r.once?this.destroy:w);o.on("mouseenter",b)}};w=new Image;n(w).on("load",function(){l.init2(this,0)});w.src=u.attr("src");b=new Image;n(b).on("load",function(){l.init2(this,1)});b.src=i.attr("href")}n.fn.CloudZoom=function(t){try{document.execCommand("BackgroundImageCache",!1,!0)}catch(r){}return this.each(function(){var r=n(this).data("zoomOptions")||{};if(n(this).is(".cloud-zoom"))n(this).css({position:"relative",display:"block"}),n("img",n(this)).css({display:"block"}),n(this).parent().attr("id")!="wrap"&&n(this).wrap('<div id="wrap" style="top:0px;z-index:9990;position:relative;"><\/div>'),n(this).data("zoom",new i(n(this),n.extend({},n.fn.CloudZoom.defaults,r,t)));else if(n(this).is(".cloud-zoom-gallery")){n(this).data("relOpts",n.extend({},r,t));n(this).on("click",n(this),function(t){var i=t.data.data("relOpts");return n("#"+i.useZoom).data("zoom").destroy(),n("#"+i.useZoom).attr("href",t.data.attr("href")),n("#"+i.useZoom+" img").attr("src",t.data.data("relOpts").smallImage),n("#"+t.data.data("relOpts").useZoom).CloudZoom(),!1})}}),this};n.fn.CloudZoom.defaults={zoomWidth:"auto",zoomHeight:"auto",position:"right",tint:!1,tintOpacity:.5,lensOpacity:.5,softFocus:!1,smoothMove:3,showTitle:!0,titleOpacity:.5,adjustX:0,adjustY:0,hoverIntent:!1,once:!1,touch:!0}})(jQuery)